<app-loader *appIf="isLoading"></app-loader>
<p-toast></p-toast>
<div class="bucket-list-container" [appClass]="{className: 'dark-mode', condition: isDarkMode}" *appIf="!isLoading">
  <div #bucketListItem class="bucket-list-item" *ngFor="let bucketListItem of userBucketLists">
    <div class="bucket-image">
      <p-image
        [src]="bucketListItem.placeImage"
        alt="image"
        width="100%"
        height="220px"
        alt="Place Image"
      ></p-image>
      <span class="distance-field">{{bucketListItem.estimatedDistance}} KMs</span>
      <div class="editDeletBtns">
        <i class="pi pi-pencil" (click)="editBucketItem(bucketListItem)"></i>
      </div>
    </div>
    <div class="content">
      <span>{{bucketListItem.placeName | titlecasepipe}}</span>
      <p>
        {{bucketListItem.placeDescription}}
      </p>
      <span>{{bucketListItem.estimatedBudget | currency:currencyCode}}</span>
    </div>
  </div>
  <div class="bucket-list-item adding-new-bucket" style="height: 300px;" (click)="showDailog()">
        <i class="pi pi-plus" (click)="showDailog()"></i>
        <p>Add a place to your Bucket List</p>
  </div>
</div>

<div class="add-bucket-contsiner" [appClass]="{className: 'dark-mode', condition: isDarkMode}">
<p-dialog
    [header]="bucketId ? 'Update Place' : 'Add Place'"
    [(visible)]="showAddBucketDailog"
    [resizable]="false"
    [draggable]="false"
    [modal]="true"
    [closeOnEscape]="false"
    (onHide)="closeDailog()"
    [closable]="false"
    
>
  <ng-template pTemplate="header" class="dialog-header">
    <h3>{{ bucketId ? 'Update Place' : 'Add Place' }}</h3>
    <i class="pi pi-times" (click)="closeDailog()"></i>
  </ng-template>

    <ng-template pTemplate="content">
    <div class="inputFields">
      <div class="inputfield">
        <label for="pi">Place Image *</label>
        <div class="image-upload-container" (click)="triggerFileinput()" *ngIf="!placeImage">
            <i class="pi pi-upload"></i>
            <p>Drag and Drop or Upload</p>
        </div>
        <input
          type="file"
          pInputText
          id="pi"
          required
          accept="image/png, image/jpeg, image/jpg"
          (change)="onFilechanges($event)"
          hidden
          #fileInput
          [confirmClose3]="placeImage"
        />
        
        <div class="selected-image" *ngIf="placeImage">
            <img [src]="placeImage" alt="Place image" width="100%" height="200px"/>
            <div>
                <i class="pi pi-pencil" (click)="triggerFileinput()"></i>
                <i class="pi pi-trash" (click)="deleteSelectedPlaceImage()"></i>
            </div>
        </div>
        <span *appIf="isPIV">{{placeImageErrormsg}}</span>
      </div>
      <div class="inputfield">
        <label for="pn">Place Name *</label>
        <input
          type="text"
          pInputText
          id="pn"
          [(ngModel)]="placeName"
          pattern="^[a-zA-Z\s]+$"
          (ngModelChange)="validatePlaceName()"
          required
          [confirmClose3]="placeName"
        />
        <span *appIf="isPNV">Place Name is Invalid*</span>
      </div>
      <div class="inputfield">
        <label for="pd">Place Description *</label>
        <input
          type="text"
          pInputText
          id="pd"
          [(ngModel)]="placeDescription"
          (ngModelChange)="validatePlaceDescription()"
          required
          [confirmClose3]="placeDescription"
        />
        <span *appIf="isPDV">Place Description is Invalid*</span>
      </div>
      <div class="inputfield">
        <label for="ed">Estimated Distance *</label>
        <input
          type="number"
          pInputText
          id="ed"
          [(ngModel)]="estimatedDistance"
          (ngModelChange)="validateED()"
          required
          [confirmClose3]="estimatedDistance ? estimatedDistance.toString() : ''"
        />
        <span *appIf="isEDV">Estimated Distance is Invalid*</span>
      </div>
      <div class="inputfield">
        <label for="eb">Estimated Budget *</label>
        <input
          type="number"
          pInputText
          id="eb"
          [(ngModel)]="estimatedBudget"
          (ngModelChange)="validateEB()"
          required
          [confirmClose3]="estimatedBudget ? estimatedBudget.toString() : ''"
        />
        <span *appIf="isEBV">Estimated Budget is Invalid*</span>
      </div>
      <div class="buttons">
        <button (click)="closeDailog()" class="cancelbtn">Cancel</button>
        <button (click)="addRecord(bucketId)" class="submitbtn">{{bucketId ? 'Update' : 'Submit'}}</button>
      </div>
    </div>
  </ng-template>
</p-dialog>
</div>

<div class="confirm-close-dialog" [appClass]="{className: 'dark-mode', condition: isDarkMode}">
  <p-dialog
    header="Confirm"
    [(visible)]="showConfirmCloseDialog"
    [modal]="true"
    [position]="'top'"
    [resizable]="false"
    [draggable]="false"
    (onHide)="closeConfirmDailog()"
    [style]="{ width: '25rem', 'top': '200px'}"
  >
    <ng-template pTemplate="content">
      <div class="confirm-close-container">
        <div class="text">
          <div class="image">
            <img src="assets/quation-mark.png" alt="Image" width="40px" height="40px">
          </div>
          <div class="message">
            <p>Are You sure?</p>
            <p>Do you really want to close the Dialog!</p>
          </div>
        </div>
        <div class="btns">
          <button (click)="closeConfirmDailog()">No</button>
          <button (click)='closeDailogAndClear()' class="yesButton">Yes</button>
        </div>
      </div>
    </ng-template>
</p-dialog>
</div>
